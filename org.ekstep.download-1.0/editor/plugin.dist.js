org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.download","ver":"1.0","author":"Gourav More","title":"download","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","menu":[],"dependencies":[{"type":"template","src":"./popup.html","bundle":true}]}},org.ekstep.contenteditor.basePlugin.extend({type:"download",initialize:function(){ecEditor.addEventListener("download:content",this.downloadContent,this);var e=ecEditor.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/popup.html");ecEditor.getService("popup").loadNgModules(e)},downloadContent:function(){var o=this;o.isSending="active",o.isLoading=!1,o.isSuccess=!1,o.isDownloading=!0;ecEditor.getService("popup").open({template:"partials_org.ekstep.download.html",controller:["$scope",function(t){t.isSending=o.isSending,t.isLoading=o.isLoading,t.isSuccess=o.isSuccess,t.isDownloading=o.isDownloading,t.cntName=ecEditor.getService("content").getContentMeta(ecEditor.getContext("contentId")).name,o.getDownloadUrl(function(e){e?(t.isLoading=!0,t.isDownloading=!1,ecEditor.ngSafeApply(ecEditor.getAngularScope()),o.sendEmail(t,e)):(t.isLoading=!1,t.isDownloading=!1,t.status=!1,t.getMessage="Content is not ready to download, please try again later",ecEditor.jQuery(".ct_download_msg").transition("drop"),ecEditor.ngSafeApply(ecEditor.getAngularScope()))})}],showClose:!1,width:900,background:"transparent!important",className:"ngdialog-theme-plain dwContent"})},getDownloadUrl:function(o){var e=ecEditor.getService("content").getContentMeta(ecEditor.getContext("contentId")).name.toLowerCase();ecEditor.getService("content").downloadContent(ecEditor.getContext("contentId"),e,function(e,t){e||"OK"!=t.data.responseCode?o(!1):o(t.data.result.ECAR_URL)})},sendEmail:function(t,e){ecEditor.jQuery.ajax({url:ecEditor.getConfig("baseURL")+"/index.php?option=com_api&app=ekcontent&resource=download&format=raw",headers:{"x-auth":"session"},type:"POST",data:{downloadUrl:e,name:ecEditor.getService("content").getContentMeta(ecEditor.getContext("contentId")).name},success:function(e){t.isLoading=!1,t.status="OK"==e.responseCode,t.getMessage=e.result,ecEditor.jQuery(".ct_download_msg").transition("drop"),ecEditor.ngSafeApply(ecEditor.getAngularScope())},error:function(){t.isLoading=!1,t.status=!1,t.getMessage="Unable to send email, please try again later",ecEditor.jQuery(".ct_download_msg").transition("drop"),ecEditor.ngSafeApply(ecEditor.getAngularScope())}})}}))