org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.collaborator","ver":"1.1","author":"Gourav More","title":"collaborator","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","menu":[],"dependencies":[{"type":"template","src":"./popup.html","bundle":true}]}},org.ekstep.contenteditor.basePlugin.extend({type:"collaborator",isCollaboratorPopupOpened:!1,initialize:function(){ecEditor.addEventListener("collaborator:add",this.addCollaborator,this);var e=ecEditor.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/popup.html");ecEditor.getService("popup").loadNgModules(e)},addCollaborator:function(e,o){this.showPreview(function(){ecEditor.jQuery("#colUsersDropdown").dropdown({apiSettings:{url:ecEditor.getConfig("baseURL")+"/index.php?option=com_ekcontent&task=contentform.getUsersToInvite&id="+window.context.id+"&isEditor=true&search={query}",cache:!0},saveRemoteData:!0,fields:{remoteValues:"results",values:"values",name:"name",text:"text",value:"value"},minCharacters:1,forceSelection:!1})}),this.collaboratorsInfo()},showPreview:function(t){var r=this;ecEditor.getService("popup").open({template:"partials_org.ekstep.collaborator.html",controller:["$scope",function(e){e.getUrlLink=r.getUrlLink,e.viewContentLink=window.context.viewContentLink,e.sendInvites=r.sendInvites,r.copyAnswer="Copy",e.copyAnswer=r.copyAnswer,e.notifyUser=r.notifyUser,e.contentId=window.context.id,e.collaborators=r.collaborators,e.loading=r.loading,e.isLoading=r.isLoading,e.isError=r.isError,e.$on("ngDialog.opened",function(e,o){r.isCollaboratorPopupOpened=!0,t()})}],showClose:!1,width:900,className:"ngdialog-theme-default"},function(){isCollaboratorPopupOpened=!1})},getUrlLink:function(){var o=this;ecEditor.jQuery("#copyTarget").select();try{var e=document.execCommand("copy");o.copyAnswer=e?"Copied!":"Unable to copy!"}catch(e){o.copyAnswer="Unsupported Browser!"}},sendInvites:function(){var t=this;ecEditor.jQuery("#colInviteForm").form({inline:!0,fields:{inviteUsers:{identifier:"inviteUsers",rules:[{type:"empty",prompt:"Please select usernames"}]},invite_msg:{identifier:"invite_msg",rules:[{type:"empty",prompt:"Invite message should not be blank"}]}},onSuccess:function(e,o){t.notifyUser(e,o)},onFailure:function(e,o){return console.log("fields validation failed"),!1}})},notifyUser:function(e,o){var t=this;ecEditor.jQuery.ajax({url:ecEditor.getConfig("baseURL")+"/index.php?option=com_ekcontent&task=contentform.inviteUsers",headers:{"x-auth":"session"},type:"POST",data:o,async:!1,beforeSend:function(){t.loading="active",t.isLoading=!0,t.isError=!1,ecEditor.ngSafeApply(ecEditor.getAngularScope())},success:function(e){1==e?t.isLoading=!1:t.isError=!0,ecEditor.jQuery(".collaborator_msg").transition("drop"),ecEditor.ngSafeApply(ecEditor.getAngularScope())},error:function(){console.log("Error")}})},collaboratorsInfo:function(){var o=this;ecEditor.jQuery.ajax({url:ecEditor.getConfig("baseURL")+"/index.php?option=com_api&app=ekcontent&resource=collaborator&format=raw",headers:{"x-auth":"session"},type:"GET",data:{id:window.context.id},async:!1,success:function(e){o.collaborators=e?e.result.collaborators:null},error:function(){console.log("Error")}})},generateTelemetry:function(e){e&&ecEditor.getService("telemetry").interact({type:e.type,subtype:e.subtype,id:e.target,pageid:org.ekstep.contenteditor.api.getCurrentStage().id||"",target:{id:e.targetid||"",type:"plugin",ver:""},plugin:{id:this.manifest.id,ver:this.manifest.ver,category:"core"},ver:"3.0"})}}))